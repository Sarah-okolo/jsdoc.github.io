{%- extends 'layout.njk' -%}

{%- macro formatTag(tagName, tagType) -%}
  {%- if tagType == 'inlineTag' -%}
    {@{{ tagName }}}
  {%- else -%}
    @{{ tagName }}
  {%- endif -%}
{%- endmacro -%}

{%- macro generateSection(tocSection) -%}
  <ul>
    {%- for item in collections[tocSection.generated] | sortTags -%}
      {%- set tagName = item.data.tag -%}
      <li>
        <a href="{{ item.filePathStem }}">{{ formatTag(tagName, tocSection.generated) }}</a>
      </li>
    {%- endfor -%}
  </ul>
{%- endmacro -%}

{%- macro renderSection(tocSection) -%}
  <h2 id="{{ tocSection.section | slugify }}">{{ tocSection.section }}</h2>
  {%- if tocSection.generated -%}
    {{ generateSection(tocSection) }}
  {%- else -%}
    <ul>
      {%- for item in tocSection.contents -%}
        <li><a href="{{ item.path | default('') }}">{{ item.title | default('') }}</a></li>
      {%- endfor -%}
    </ul>
  {%- endif -%}
{%- endmacro -%}

{%- macro synonyms(item, tagType) -%}
  {%- if item.data.synonyms -%}
    {%- set comma = joiner(', ') -%}
    (synonyms: {% for synonym in item.data.synonyms -%}
      {{ comma() }}{{ formatTag(synonym, tagType) -}}
    {%- endfor -%})
  {%- endif -%}
{%- endmacro -%}


{%- block content -%}
  <nav class="nav-sidebar">
    <ion-icon name="close-outline" id="closeMenuIcon"></ion-icon>
    {%- for tocSection in toc -%}
      {{ renderSection(tocSection) }}
    {%- endfor -%}
  </nav>

  <article class="article-content">
    {% if title -%}
      <h1>{{ title }}</h1>
    {%- endif %}
      
    {{ content | safe }}

    {%- if related | length -%}
      {%- set relatedLinks = related | relatedList(collections) -%}
      <h2 id="related-links">Related links</h2>
      <ul>
        {%- for relatedLink in relatedLinks -%}
          <li><a href="{{ relatedLink.path }}">{{ relatedLink.title }}</a></li>
        {%- endfor -%}
      </ul>
    {%- endif -%}

    <!-- Additional content, GitHub ribbon -->
    <p>
      <a href="https://github.com/jsdoc/jsdoc" class="github-ribbon">Fork me on<br>GitHub</a>
    </p>
  </article>
{% endblock %}